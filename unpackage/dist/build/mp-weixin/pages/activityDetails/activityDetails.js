(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activityDetails/activityDetails"],{"062c":function(t,e,a){"use strict";(function(t){a("1f75");i(a("66fd"));var e=i(a("d945"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"27a0":function(t,e,a){"use strict";a.r(e);var i=a("281f"),n=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a},"281f":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){Promise.all([a.e("common/vendor"),a.e("components/uni-popup/uni-popup")]).then(function(){return resolve(a("5592"))}.bind(null,a)).catch(a.oe)},n=function(){a.e("components/Activity").then(function(){return resolve(a("be53"))}.bind(null,a)).catch(a.oe)},o={components:{uniPopup:i,Activity:n},data:function(){return{imgUrl:"",tmpImg:"",width:570,height:820,pixelRatio:2,codePath:"/static/tmp/code.jpg",poserImg:"https://t8.baidu.com/it/u=3887179165,3572970878&fm=79&app=86&size=h300&n=0&g=4n&f=jpeg?sec=1596352536&t=2736120db00abcf307212a6d5ddfce18",totalDays:"",laveDays:"",detailData:{},top:22,scrollTop:0,showAd:!0,toIndex:"",letterDetails:[],currentLetter:"Details",type:0,showFixed:!0,status:0,tagList:[],giveList:[],oldEve:[],buyStatus:0}},filters:{changeTime:function(t){return t?t.substr(0,10):""}},onLoad:function(e){this.imgUrl=this.$baseUrl,this.top=t.getMenuButtonBoundingClientRect().top,this.detailData=getApp().globalData.activeData,this.buyStatus=this.detailData.isBuy,this.getLaveTime(),this.getCates(),this.getGiveCourse(),this.getOldEve(),this.getTeamList()},onShareAppMessage:function(t){return"button"===t.from&&console.log(t.target),{title:"自定义分享标题",path:"/pages/index/index"}},methods:{getTeamList:function(){var t=this;this.$api.get("/api/team/myTeam",{params:{actId:this.detailData.id}}).then((function(e){t.teamData=e.data}))},tk:function(){var e=this;2!=this.buyStatus?this.$api.post("/api/order/refund",{id:this.detailData.orderId}).then((function(a){e.detailData.buyStatus=2,t.showToast({title:a.message,icon:"none"})})):t.showToast({title:"退款中",icon:"none"})},aloneBuy:function(){t.navigateTo({url:"/pages/joinDetail/joinDetail?type=2"})},getPhone:function(){this.detailData.organizerPhone&&t.makePhoneCall({phoneNumber:this.detailData.organizerPhone})},downFile:function(){this.detailData.filepath?t.downloadFile({url:this.imgUrl+this.detailData.filepath,success:function(e){200===e.statusCode&&t.showToast({title:"下载成功"})}}):t.showToast({title:"附件地址不存在",icon:"none"})},doCollect:function(){var t=1==this.detailData.isStore?0:1;this.collected(t)},collected:function(e){var a=this;this.$api.post("/api/user/store",{type:1,status:e,tableId:this.detailData.id,userId:t.getStorageSync("userInfo").id}).then((function(t){a.detailData.isStore=e}))},getOldEve:function(){var t=this;this.$api.get("/api/act/getCommentActivityId",{params:{activityId:this.detailData.id}}).then((function(e){t.oldEve=e.data}))},getGiveCourse:function(){var t=this;this.$api.get("/api/act/getLessonByActivityId",{params:{activityId:this.detailData.id}}).then((function(e){e.data.length>0&&(t.giveList=e.data)}))},getCates:function(){var t=this;this.$api.get("/api/static/dictList",{params:{type:1}}).then((function(e){console.log(e.data);var a="",i=[];e.data.forEach((function(e){e.id==t.detailData.typeId&&(i.push(e.name),a=e.pid)})),console.log(i),e.data.forEach((function(e){e.id==a&&(i.push(e.name),t.tagList=i)}))}))},getLaveTime:function(){var t=this.detailData.startDate.replace(new RegExp("-","gm"),"/").substr(0,10),e=this.detailData.endDate.replace(new RegExp("-","gm"),"/").substr(0,10);t=new Date(t).getTime(),e=new Date(e).getTime(),this.totalDays=this.geta(t,e);var a=(new Date).getTime(),i=this.detailData.signEndDate.replace(new RegExp("-","gm"),"/").substr(0,10);i=new Date(i).getTime(),this.laveDays=this.geta(a,i)},geta:function(t,e){var a=e-t,i=Math.floor(a/864e5);return i+1},goInfo:function(){t.navigateTo({url:"/pages/togetherInfo/togetherInfo?actId="+this.detailData.id})},goCommet:function(){t.navigateTo({url:"/pagesA/courseEvaluation/courseEvaluation?type=1"})},toView:function(t){this.toIndex=t,this.currentLetter=t},scrollHandle:function(e){var a=this,i=e.detail.scrollTop;this.scrollTop=i;var n=t.createSelectorQuery().in(this).selectAll(".module");n.boundingClientRect((function(t){var e=t[0].top;t.forEach((function(t){t.top=t.top-e,t.bottom=t.bottom-e,a.letterDetails.push({id:t.id,top:t.top,bottom:t.bottom})})),a.letterDetails.some((function(t){if(i-180>=t.top&&i-180<=t.bottom-20)return a.currentLetter=t.id,!0}))})).exec()},goBack:function(){t.navigateBack({delta:1})},showGroupPop:function(){this.$refs.popup.open()},OpenGroup:function(){var e=this;this.$api.get("/api/user/getUserInfo").then((function(a){e.$refs.popup.close(),a.data.level>=3?t.navigateTo({url:"/pages/joinDetail/joinDetail?type=1"}):e.$refs.popup1.open()}))},viewAll:function(e){getApp().globalData.oldActiveData=e,t.navigateTo({url:"/pages/comment/comment"})},closePoser:function(){this.$refs.poster.close()},getPoster:function(){var e=this;this.$refs.sharePop.close(),t.showLoading({title:"海报生成中...",mask:!0});var a=this,i=wx.createCanvasContext("myCanvas");i.width=this.width,i.height=this.height;i.width;wx.getImageInfo({src:this.poserImg,success:function(n){i.fillStyle="#FFFFFF",i.fillRect(0,0,e.width,e.height),i.drawImage(n.path,0,0,e.width,530),i.setFontSize(28),i.setFillStyle("#000000"),i.setTextAlign("center");var o="杭州小记者内蒙古宁夏夏令营梦幻迪士尼";o.length>20&&(o=o.substr(0,20)+"..."),i.fillText(o,e.width/2,600);var s="长按识别，立即参加";i.setFontSize(28),i.fillText(s,320,760),i.save(),i.restore();var r="邀您参加";i.setFillStyle("#666666"),i.font="normal bold 24px sans-serif",i.fillText(r,340,720),i.save(),i.restore();var c="张雨溪";i.setFillStyle("#000000"),i.font="normal bold 26px sans-serif",i.fillText(c,340,690),i.save(),i.restore(),wx.getImageInfo({src:a.codePath,success:function(n){i.drawImage(a.codePath,33,650,132,132),wx.getImageInfo({src:e.poserImg,success:function(a){console.log(a);var n=62,o=62,s=200,r=660;i.beginPath(),i.arc(n/2+s,o/2+r,n/2,0,2*Math.PI,!1),i.clip(),i.drawImage(a.path,200,660,62,62),i.save(),i.draw(),setTimeout((function(){wx.canvasToTempFilePath({canvasId:"myCanvas",x:0,y:0,width:e.width,height:e.height,destWidth:e.width,destHeight:e.height,success:function(a){var i=a.tempFilePath;e.tmpImg=i,console.log(i),t.hideLoading(),e.$refs.poster.open()},fail:function(e){console.log(e),t.hideLoading()}})}),300)}})}})}})},saveImageToPhotosAlbum:function(){var t=this,e=t.tmpImg;void 0!=e&&""!=e&&wx.saveImageToPhotosAlbum({filePath:e,success:function(t){wx.showToast({title:"已保存到相册",icon:"none",duration:1500,mask:!0})},fail:function(t){console.error(t),console.error("打开设置窗口"),wx.openSetting({success:function(t){console.error(t),t.authSetting["scope.writePhotosAlbum"]?console.error("获取权限成功，再次点击图片保存到相册"):console.error("获取权限失败")}})}})}}};e.default=o}).call(this,a("543d")["default"])},"3ca0":function(t,e,a){"use strict";var i={uniPopup:function(){return Promise.all([a.e("common/vendor"),a.e("components/uni-popup/uni-popup")]).then(a.bind(null,"5592"))}},n=function(){var t=this,e=t.$createElement,a=(t._self._c,t._f("changeTime")(t.detailData.startDate)),i=t._f("changeTime")(t.detailData.endDate),n=t._f("changeTime")(t.detailData.signStartDate),o=t._f("changeTime")(t.detailData.signEndDate);t._isMounted||(t.e0=t.$refs.sharePop.open,t.e1=function(e){return t.$refs.showMyGroup.open()},t.e2=function(e){return t.$refs.showMyGroup.open()},t.e3=function(e){t.showAd=!1},t.e4=t.$refs.popup1.close),t.$mp.data=Object.assign({},{$root:{f0:a,f1:i,f2:n,f3:o}})},o=[];a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return i}))},"6be0":function(t,e,a){},"845f":function(t,e,a){"use strict";var i=a("6be0"),n=a.n(i);n.a},d945:function(t,e,a){"use strict";a.r(e);var i=a("3ca0"),n=a("27a0");for(var o in n)"default"!==o&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("845f");var s,r=a("f0c5"),c=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);e["default"]=c.exports}},[["062c","common/runtime","common/vendor"]]]);